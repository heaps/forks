<!DOCTYPE html>
<html>
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">

<h1>Balance List</h1>
Check Balance:
<button onclick="getBalance()">Get Balance</button><br><br>
<div id="status" style="color:#0000FF"></div>

<script>

// -------------------------------------------
//      sample accounts with city
//      REMOVE: private keys before deploy
// -------------------------------------------

var accounts = [{"address":"0xfeB9eA72F2CFD288A0FC4DDfD483Ac2BBC7Cd616","label":"Arlington"},{"address":"0xC15644086071Cdc9359124c53fe0C298c9918E29","label":"Boston"},{"address":"0x7a969C7D96e6665761E94D9405A31793d59Ce757","label":"Beverly"},{"address":"0xB300D4d57f6a46353C2E6BFd73a879758023b764","label":"Braintree"},{"address":"0xEc642886061b9628fcE1eC48783cc6Faed36e700","label":"Brookline"},{"address":"0xC91735137c1368DFE4A2A883e6a7591ed617846e","label":"Cambridge"},{"address":"0xAa9a42BeEDDC497c3Ca470b5b01251B39142D097","label":"Canton"},{"address":"0x38c7b0F9F0f8bB586Cb02Ef48Af88Fd991c66C7B","label":"Charlestown"},{"address":"0x456039e7498b5D3d9A0Cd776052287C17eE48B49","label":"Clinton"},{"address":"0x480b5b6874ab5a7A6104bAF73fD66c493b42eED6","label":"Concord"},{"address":"0x944e30798F1F96b6568538b99201222a3eDcb89D","label":"Danvers"},{"address":"0x02904A44B217000B58c9e9C2256aCD6371F2d0B6","label":"Dartmouth"},{"address":"0xDcDfB0BC233068f80b08f2B0C6df66Fe802906A1","label":"Dedham"},{"address":"0x1eED558A075c699832741e112db0434f3B845076","label":"Dennis"},{"address":"0x1d7F2FaaCD04b17F52074fCEf8d9769e73f57945","label":"Duxbury"},{"address":"0x4ee3a8613AC1935624e5C71D0879347b71D27D72","label":"Eastham"},{"address":"0x5b91fE0d28EBCffDc0D84065432A95F798F9AeB4","label":"Edgartown"},{"address":"0xC96b7F78D44726a6a452ceB97221000117d93d15","label":"Everett"},{"address":"0x3dfF98cc6Ab70F365157Bb1DD91cB9BCA8A63DdC","label":"Fairhaven"},{"address":"0x6B67dB9090240D1Da5d6eA7A31931a25890896B3","label":"Falmouth"},{"address":"0xF95e60f9C24d6Cb5BA3008b888F61503F1e71324","label":"Hyannis"},{"address":"0x61C76710Aec211bF6753178786CD79E2B7456c1f","label":"Lexington"},{"address":"0xCeb331C53816E6cD907f8425eBC7c968B9767256","label":"Malden"},{"address":"0x2BB4A0f05EfA0Ad28b33F54DC665A025D848baEF","label":"Medford"},{"address":"0xa30b5b8B84FCF352959224239a06928838e114f7","label":"Milton"},{"address":"0xc66b8e0DF1A44e445DDe50E671AD3F42f2f6c532","label":"Natick"},{"address":"0xFa2291E8CD8783468A33B3Dec48aCA4EF8A17900","label":"Newton"},{"address":"0xc10547F88E9ebb7CF41B74c1eE1d922817BCF80E","label":"Norwood"},{"address":"0x75D746dD9bdA961d2c220DF25B627E4667Fe4286","label":"Wellesley"},{"address":"0x85784603d9E4d1B9C85b4076A06f46CAF2CA65b1","label":"Watertown"}
];

// create an instance of web3 from MetaMask
if (typeof web3 !== 'undefined') {
  web3 = new Web3(web3.currentProvider);
} else {
  // set the provider you want from Web3.providers
  web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
}

// counter for array item
var counter = 0;

function getBalance(){

	accounts.forEach(function(account){

		// get the balance of account
		web3.eth.getBalance(account.address, function(err, res){
			counter++;

			// add balance to account object in accounts array
			// fromWei returns ether equivalent
			addBalance(account,web3.fromWei(res));

			// if all account data has returned, display data
			if (counter >= accounts.length){
				displayBalances();
			}
		});
	});
}

function displayBalances(){

	var table = '<table class="table" >' +
  					'<thead class="thead-light">' +
					    '<tr>' +
					      '<th scope="col">balance</th>' +
					      '<th scope="col">account</th>' +
					      '<th scope="col">address</th>' +
					    '</tr>' +
					 '</thead>' +
					 '<tbody>';

	accounts.forEach(function(account){
		table += '<tr>';
		table += '  <td>' + account.balance + '</td>';
		table += '  <td>' + account.label + '</td>';		
		table += '  <td>' + account.address + '</td>';				
		table += '</tr>';		
	});

  	table += '  </tbody>';
	table += '</table>';
	document.getElementById('status').innerHTML += table;

}

function addBalance(account, balance){
	account.balance = balance;
}

window.onload = function(){
	// new metamask requirement - user permission
	// permission must be given to read account data	
	ethereum.enable();	
}


</script>
</html>

