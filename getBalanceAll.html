<!DOCTYPE html>
<html>
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">

<h1>Balance List</h1>
Check Balance:
<!-- <button onclick="getBalance()">Get Balance</button><br><br> -->
<div id="status" style="color:#0000FF"></div>

<script>

(async function(){

// -------------------------------------------
//      sample accounts with city
//      REMOVE: private keys before deploy
// -------------------------------------------

var accounts = [
    {
      "address": "0xD1D618bcb179db8b020358710138D1A008f4f39E",
      "label": "Abel"
    },
    {
        "address": "0xf0fAaaa7b45fE199A678fB1CB81a2ca8210674Aa",
        "label": "Arlington"
    },
    {
        "address": "0x8bB1fc566E8C66ab24D03517f9E011a84Fff941b",
        "label": "Belmont"
    },
    {
        "address": "0xE76dD96471e7FD4fadaebD4e428115159d181800",
        "label": "Beverly"
    },
    {
        "address": "0xa934F512adD7539B11134Bd904e58204A9908370",
        "label": "Boston"
    },
    {
        "address": "0x6Ad240e735B8a26539Bf2C4dA60b0614e19001Df",
        "label": "Braintree"
    },
    {
        "address": "0x435e0423C7bB679c471899F12158e41C121fB5Bb",
        "label": "Brookline"
    },
    {
        "address": "0x6390a41A32923e2043B3873628C2b2Ffb29052Ae",
        "label": "Cambridge"
    },
    {
        "address": "0x13f186dB62A015464C16693b919CE696a84b1775",
        "label": "Canton"
    },
    {
        "address": "0x8812eE71761f37E828aAF4Eb111a87ac09006715",
        "label": "Chappaquiddick"
    },
    {
        "address": "0x497CF803b707798E2eC1b021194940Ca39563657",
        "label": "Charlestown"
    },
    {
        "address": "0xDefFDB0557b67F790d4E2Ee96112Fd69971bB162",
        "label": "Clinton"
    },
    {
        "address": "0xdb98B51f20774335D852eC55893C0DD1361219AC",
        "label": "Concord"
    },
    {
        "address": "0x62bBe8E62604d9E741b46f7C5956a3e797C82C03",
        "label": "Danvers"
    },
    {
        "address": "0x57e2634c9B95973f4e739B3E4E04b5Ae8C2fA24b",
        "label": "Dartmouth"
    },
    {
        "address": "0x4c518A1f489A03b1897b96EC94d610F6f5381969",
        "label": "Dedham"
    },
    {
        "address": "0xB644db1cA2A997CB53DF9217cC3De6F7eCFf7691",
        "label": "Dennis"
    },
    {
        "address": "0xa89135969eAFE1497f319abfCf2aC2E3c9a18032",
        "label": "Duxbury"
    },
    {
        "address": "0x418e9bc0eEBB0b6c10d27a520Ea0c0AACA0a3472",
        "label": "Eastham"
    },
    {
        "address": "0x6fc14E2c727E0926630239248183C2FCCaaeE64C",
        "label": "Edgartown"
    },
    {
        "address": "0xBec7Ef9D332c59C4B148B5E0141ABeac6e560852",
        "label": "Everett"
    },
    {
        "address": "0x6E0385c7E4bb31DA0587Df2132BCEc912B566d5F",
        "label": "Fairhaven"
    },
    {
        "address": "0xB20319108b6A1957afff765685CdFC4B4dabDb0a",
        "label": "Falmouth"
    },
    {
        "address": "0xD08453522Ca6B46E9f27110677CA9C5dCe960E68",
        "label": "Hyannis"
    },
    {
        "address": "0x43549d2Bf1a7B765B9F9E0799E11bED5D64bAf28",
        "label": "Lexington"
    },
    {
        "address": "0x7fd3315630F8Ac191d2b8c0571E15Fee535F11d2",
        "label": "Malden"
    },
    {
        "address": "0x4a9C075a33eD9315D89450116E69F0F61729437B",
        "label": "Medford"
    },
    {
        "address": "0xE5be4B8CD7E7fE9fbF17254F4AB1E08F5f2506a4",
        "label": "Milton"
    },
    {
        "address": "0xbd1a5A1767d28746F1943A660299F00f4284525C",
        "label": "Natick"
    },
    {
        "address": "0xEef3512F4C391A16A5214A4EEE230b4F4564f3c3",
        "label": "Newton"
    },
    {
        "address": "0xaa4110cC41D53A0A8297cbD601c9952512FCfD37",
        "label": "Norwood"
    },
    {
        "address": "0xB3409b75d49C3FD827d583ecdCE7d5DF82ac65d0",
        "label": "Somerville"
    },
    {
        "address": "0xDd2226DE91259f12346c8934571ABc1207F4bB42",
        "label": "Wellesley"
    },
    {
        "address": "0x09D7A3C38594C89f22F695b311918b32e09439aC",
        "label": "Waltham"
    },
    {
        "address": "0x71df132DEa038b70a0b4892f7F04Cfe897097548",
        "label": "Watertown"
    },
    {
        "address": "0xfC01e4c8875bb98bCadBa4849A54921D7463639d",
        "label": "Weston"
    }
];


// window.ethereum
if (typeof window.ethereum !== 'undefined') {
  console.log('MetaMask is installed!');
}

// counter for array item
var counter = 0;

async function getBalance(accounts){

  var length = accounts.length;
  for (var i = 0; i < length; i++) {
    counter++;

    var balance = await ethereum.request({ method: 'eth_getBalance', params:[accounts[i].address,'latest']});
    balance = parseInt(balance, 16);
    balance = Math.floor(balance/1000000000000000000);

    // add balance to account object in accounts array
    // fromWei returns ether equivalent
    addBalance(accounts[i],balance);

	};
  console.log(accounts);
  return accounts;
}

function displayBalances(accounts){

	var table = '<table class="table" >' +
  					'<thead class="thead-light">' +
					    '<tr>' +
					      '<th scope="col">balance</th>' +
					      '<th scope="col">account</th>' +
					      '<th scope="col">address</th>' +
					    '</tr>' +
					 '</thead>' +
					 '<tbody>';

	accounts.forEach(function(account){
		table += '<tr>';
		table += '  <td>' + account.balance + '</td>';
		table += '  <td>' + account.label + '</td>';		
		table += '  <td>' + account.address + '</td>';				
		table += '</tr>';		
	});

  	table += '  </tbody>';
	table += '</table>';
	document.getElementById('status').innerHTML += table;

}

function addBalance(account, balance){
	account.balance = balance;
}

accounts = await getBalance(accounts);
console.log(accounts);
displayBalances(accounts);


})();

</script>
</html>

